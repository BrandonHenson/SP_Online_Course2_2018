"""
This module will connect to Redis cloud, initialize the cache, and perform 
functions on the cached data.
Assignment: 
Create lookup data for validation purposes using Redis. 
You will need to populate a cache,
and show how you use the Redis cache to read the data.
"""

import configparser
from pathlib import Path
import redis

import utilities

log = utilities.configure_logger('default', '../logs/login_databases_dev.log')
config_file = Path(__file__).parent.parent / '.config/config.ini'
config = configparser.ConfigParser()


class RedisMailroomClient():

    def __init__():
        try:
            config.read(config_file)
            host = config["redis_cloud"]["host"]
            port = config["redis_cloud"]["port"]
            pw = config["redis_cloud"]["pw"]

        except Exception as e:
            print(f'error: {e}')

        log.info('Here is where we use the connect to redis.')

        try:
            r = redis.StrictRedis(host=host, port=port,
                                  password=pw, decode_responses=True)

        except Exception as e:
            print(f'error: {e}')

        self.r = r

        lookup_data = self.parse_lookup_file('lookup_list.txt')
        self.populate_lookup_data(lookup_data)


    def populate_lookup_data(self, lookup_list):
        """
        Take list of donors, create lookup data for each of them.
        Name: Email, Phone Number, Security Question answer
        """
        for name, email, phone, sec_q in lookup_list:
            self.r.hmset(name, {'email': email, 'phone_num': phone,
                                'security_answ': sec_q})


    def parse_lookup_file(self, path):
        lookup_list = []
        with (path, 'r') as lookup_file:
            for line in lookup_file:
                lookup_list.append(tuple(line[:-1].split(','))
        return lookup_list


    def validate_field(self, name, email)
        r_email = self.r.hget(name, 'email')
        return email == r_email


    def validate_phone_num(self.r, name, numb):
        r_phone = self.r.hget(name, 'phone_num')
        return numb == r_phone


    def validate_security_q(self.r, name, answer):
        r_answer = self.r.hget(name, 'security_answ')
        return answer == r_answer
